env:
  DOTNET_VERSION: '7.0.x'                 # set this to the .NET Core version to use

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      - name: Set up .NET Core
        uses: actions/setup-dotnet@v2
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}
          
      - name: Get version
        id: get_version
        uses: greenygh0st/net-proj-release-version@v1
        with:
          
          # Filepath of the *.csproj file, relative to root of repository
          PROJ_FILE: src/PuppetMaster.Client.UI/PuppetMaster.Client.UI.csproj

      - name: Build with dotnet
        run: dotnet build --configuration Release

      - name: dotnet publish
        run: dotnet publish -c Release

      - name: Create Release
        # You may pin to the exact commit or the version.
        # uses: ncipollo/release-action@a2e71bdd4e7dab70ca26a852f29600c98b33153e
        uses: ncipollo/release-action@v1.12.0
        with:
          # An optional set of paths representing artifacts to upload to the release. This may be a single path or a comma delimited list of paths (or globs)
          artifacts: src/PuppetMaster.Client.UI/Releases/*.*
          name: "Version ${{ steps.get_version.outputs.RELEASE_VERSION }}" # optional, default is 
          # An optional tag for the release. If this is omitted the git ref will be used (if it is a tag).
          tag: "${{ steps.get_version.outputs.RELEASE_VERSION }}"
